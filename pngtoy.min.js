function PngToy(e){this.doCRC=!0,this.allowInvalid=!1,this.beforeSend=function(){},Object.assign(this,e),this.url=null,this.buffer=null,this.view=null,this.chunks=[],this.debug={}}PngToy.prototype={fetch:function(n){var a=this;return a.url=n,a.buffer=a.chunks=a.view=null,a._pos=0,new Promise(function(r,i){if("string"==typeof n)try{var e=new XMLHttpRequest;e.open("GET",n,!0),e.responseType="arraybuffer",a.beforeSend(e),e.onerror=function(e){i("Network error. "+e.message)},e.onload=function(){200===e.status?t(e.response):i("Loading error:"+e.statusText)},e.send()}catch(e){i(e.message)}else t(ArrayBuffer.isView(n)?n.buffer:n);function t(e){var t,n;try{t=new DataView(e),66<e.byteLength&&2303741511===t.getUint32(0)&&218765834===t.getUint32(4)?(n=PngToy._getChunks(e,t,a.doCRC,a.allowInvalid),a.buffer=e,a.view=t,a.chunks=n.chunks||[],a.chunks||a.allowInvalid?r():i(n.error)):i("Not a PNG file.")}catch(e){i(e.message)}}})},getChunk:function(e){return-1<["IHDR","IDAT","PLTE","sPLT","tRNS","iTXt","tEXt","zTXt","iCCP","gAMA","cHRM","sRGB","hIST","sBIT","pHYs","bKGD","tIME","oFFs","sTER","sCAL","pCAL","IEND"].indexOf(e)?"IEND"===e?!!PngToy._findChunk(this.chunks,"IEND"):PngToy["_"+e](this):PngToy._findChunk(this.chunks,e)},toMinimal:function(e){if(this.chunks.length){var t=["IHDR","IDAT","IEND","PLTE","tRNS","gAMA"],n=[new Uint32Array([1196314761,169478669])];return this.chunks.forEach(function(e){-1<t.indexOf(e.name)&&n.push(e.getRaw(!0))}),new Blob(n,{type:e?"application/octet-stream":"image/png"})}throw"No file loaded (see fetch())."},getGammaLUT:function(e,t,n){for(var r=new Uint8Array(256),i=1/((e||1)*(t||2.2)*(n||1)),a=0;a<256;a++)r[a]=Math.round(255*Math.pow(a/255,i));return r},guessDisplayGamma:function(){return-1<navigator.userAgent.indexOf("Mac OS")?1.8:2.2}},PngToy._blockSize=1<<21,PngToy._delay=7,"undefined"!=typeof exports&&(exports.PngToy=PngToy);var ezlib=ezlib||{_async:function(r,e,i,a,o){var s,l,f=(o=o||{}).lapTime||200,u=o.delay||9,h=0,c=e?(s=new ezlib.Deflate(o),o.asyncBlock||1<<18):(s=new ezlib.Inflate(o),o.asyncBlock||1<<19),d=performance.now();(function e(){var t=r.subarray(h,h+c),n=(h+=c)>=r.length;s.push(t,n),n?setTimeout(function(e){e.err?a&&a({msg:e.msg}):i({result:e.result})},u,s):(l=performance.now(),f<=l-d?(d=l,o.progress&&o.progress({progress:h/r.length}),setTimeout(e,u)):e())})()}};function PngImage(){var t,n="",r=this,i=new PngToy,a=0,o=0,s=!1;function l(e){i.decode(e).then(f,u)}function f(e){a=e.width,o=e.height,i.convertToCanvas(e,{ignoreAspectRatio:!1,useGamma:!1}).then(function(e){t=e,s=!0,r.onload&&r.onload({timeStamp:Date.now()})}.bind(r),u.bind(r))}function u(e){r.onerror&&r.onerror({message:e,timeStamp:Date.now()})}this.onload=null,this.onerror=null,this.onabort=null,Object.defineProperty(this,"src",{get:function(){return n},set:function(e){n=e,i.fetch(n).then(l,u)}}),Object.defineProperty(this,"width",{get:function(){return a}}),Object.defineProperty(this,"height",{get:function(){return o}}),Object.defineProperty(this,"naturalWidth",{get:function(){return a}}),Object.defineProperty(this,"naturalHeight",{get:function(){return o}}),Object.defineProperty(this,"image",{get:function(){return t}}),Object.defineProperty(this,"pngtoy",{get:function(){return i}}),Object.defineProperty(this,"complete",{get:function(){return s}})}ezlib.inflateAsync=function(n,r,e,t){if(2===arguments.length&&"undefined"!=typeof Promise)return new Promise(function(e,t){ezlib._async(n,!1,e,t,r)});ezlib._async(n,!1,e,t,r)},ezlib.Inflate=function(e){this.options=t=Object.assign(e||{},{chunkSize:16384,windowBits:0}),t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.ended=!1,this.result,this.err=0,this.msg="",this.chunks=[],this.onend=null,this.onerror=null,this.strm=new ezlib.ZStream,this.strm.avail_out=0;var t=ezlib.zlib_inflate.inflateInit2(this.strm,t.windowBits);if(0!==t)throw new Error(ezlib.msg[t]);this.header=new ezlib.GZheader,ezlib.zlib_inflate.inflateGetHeader(this.strm,this.header)},ezlib.Inflate.prototype={push:function(e,t){var n,r,i=this.strm,a=this.options.chunkSize,o=this.options.dictionary,s=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),2===(n=ezlib.zlib_inflate.inflate(i,0))&&o&&(n=ezlib.zlib_inflate.inflateSetDictionary(this.strm,o)),-5===n&&!0===s&&(n=0,s=!1),1!==n&&0!==n)return this.onEnd(n),!(this.ended=!0)}while(i.next_out&&(0!==i.avail_out&&1!==n&&(0!==i.avail_in||4!==r&&2!==r)||this.onData(ezlib.utils.shrinkBuf(i.output,i.next_out))),0===i.avail_in&&0===i.avail_out&&(s=!0),(0<i.avail_in||0===i.avail_out)&&1!==n);return 1===n&&(r=4),4===r?(n=ezlib.zlib_inflate.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,0===n):(2===r&&(this.onEnd(0),i.avail_out=0),!0)},onData:function(e){this.chunks.push(e)},onEnd:function(t){0===t?(this.result=ezlib.utils.flattenChunks(this.chunks),this.onend&&setTimeout(function(e){e.onend(e.result)},5,this)):this.onerror&&setTimeout(function(e){e.onerror({status:t,msg:e.strm.msg})},5,this),this.chunks=[],this.err=t,this.msg=this.strm.msg}},ezlib.inflate=function(e,t){t=new ezlib.Inflate(t);if(t.push(e,!0),t.err)throw t.msg;return t.result},ezlib.utils=ezlib.utils||{arraySet:function(e,t,n,r,i){e.set(t.subarray(n,n+r),i)},flattenChunks:function(e){for(var t,n,r,i=0,a=0,o=e.length;a<o;a++)i+=e[a].length;for(r=new Uint8Array(i),a=t=0,o=e.length;a<o;a++)n=e[a],r.set(n,t),t+=n.length;return r},shrinkBuf:function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}},ezlib.msg=ezlib.msg||{2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ezlib.adler32=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){for(o=2e3<n?2e3:n,n-=o;a=a+(i=i+t[r++]|0)|0,--o;);i%=65521,a%=65521}return i|a<<16|0},ezlib.crc32=ezlib.crc32||function(){var s=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();return function(e,t,n,r){var i=s,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e}}(),ezlib.GZheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},ezlib.inflate_fast=ezlib.inflate_fast||function(e,t){var n,r,i,a,o,s,l=e.state,f=e.next_in,u=e.input,h=f+(e.avail_in-5),c=e.next_out,d=e.output,g=c-(t-e.avail_out),b=c+(e.avail_out-257),m=l.dmax,w=l.wsize,p=l.whave,k=l.wnext,v=l.window,y=l.hold,T=l.bits,_=l.lencode,P=l.distcode,I=(1<<l.lenbits)-1,x=(1<<l.distbits)-1;e:do{T<15&&(y+=u[f++]<<T,T+=8,y+=u[f++]<<T,T+=8),n=_[y&I];t:for(;;){if(y>>>=r=n>>>24,T-=r,0===(r=n>>>16&255))d[c++]=65535&n;else{if(!(16&r)){if(0==(64&r)){n=_[(65535&n)+(y&(1<<r)-1)];continue t}if(32&r){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}i=65535&n,(r&=15)&&(T<r&&(y+=u[f++]<<T,T+=8),i+=y&(1<<r)-1,y>>>=r,T-=r),T<15&&(y+=u[f++]<<T,T+=8,y+=u[f++]<<T,T+=8),n=P[y&x];n:for(;;){if(y>>>=r=n>>>24,T-=r,!(16&(r=n>>>16&255))){if(0==(64&r)){n=P[(65535&n)+(y&(1<<r)-1)];continue n}e.msg="invalid distance code",l.mode=30;break e}if(a=65535&n,T<(r&=15)&&(y+=u[f++]<<T,(T+=8)<r&&(y+=u[f++]<<T,T+=8)),m<(a+=y&(1<<r)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(y>>>=r,T-=r,(r=c-g)<a){if(r=a-r,p<r&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(s=v,(o=0)===k){if(o+=w-r,r<i){for(i-=r;d[c++]=v[o++],--r;);o=c-a,s=d}}else if(k<r){if(o+=w+k-r,(r-=k)<i){for(i-=r;d[c++]=v[o++],--r;);if(o=0,k<i){for(r=k,i-=r;d[c++]=v[o++],--r;);o=c-a,s=d}}}else if(o+=k-r,r<i){for(i-=r;d[c++]=v[o++],--r;);o=c-a,s=d}for(;2<i;)d[c++]=s[o++],d[c++]=s[o++],d[c++]=s[o++],i-=3;i&&(d[c++]=s[o++],1<i&&(d[c++]=s[o++]))}else{for(o=c-a;d[c++]=d[o++],d[c++]=d[o++],d[c++]=d[o++],i-=3,2<i;);i&&(d[c++]=d[o++],1<i&&(d[c++]=d[o++]))}break}}break}}while(f<h&&c<b);f-=i=T>>3,y&=(1<<(T-=i<<3))-1,e.next_in=f,e.next_out=c,e.avail_in=f<h?h-f+5:5-(f-h),e.avail_out=c<b?b-c+257:257-(c-b),l.hold=y,l.bits=T},ezlib.zlib_inflate=ezlib.zlib_inflate||function(){var A=1,U=2,R=0,E=-2,S=1,n=852,r=592;function D(e){return e>>>24|e>>>8&65280|e<<8&16711680|e<<24}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0}function a(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(n),t.distcode=t.distdyn=new Int32Array(r),t.sane=1,R):E}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,a(e)):E}function s(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?E:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,o(e))):E}function t(e,t){var n;return e?(n=new i,(e.state=n).window=null,(t=s(e,t))!==R&&(e.state=null),t):E}var L,M,B=!0;function X(e,t,n,r){var i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(ezlib.utils.arraySet(i.window,t,n-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(r<(e=i.wsize-i.wnext)&&(e=r),ezlib.utils.arraySet(i.window,t,n-r,e,i.wnext),(r-=e)?(ezlib.utils.arraySet(i.window,t,n-r,r,0),i.wnext=r,i.whave=i.wsize):(i.wnext+=e,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=e))),0}return{inflateReset:o,inflateReset2:s,inflateResetKeep:a,inflateInit:function(e){return t(e,15)},inflateInit2:t,inflate:function(e,t){var n,r,i,a,o,s,l,f,u,h,c,d,g,b,m,w,p,k,v,y,T,_,P,I,x=0,C=new Uint8Array(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return E;12===(n=e.state).mode&&(n.mode=13),o=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,f=n.hold,u=n.bits,h=s,c=l,_=R;e:for(;;)switch(n.mode){case S:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(2&n.wrap&&35615===f){C[n.check=0]=255&f,C[1]=f>>>8&255,n.check=ezlib.crc32(n.check,C,2,0),u=f=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&f)){e.msg="unknown compression method",n.mode=30;break}if(u-=4,T=8+(15&(f>>>=4)),0===n.wbits)n.wbits=T;else if(T>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<T,e.adler=n.check=1,n.mode=512&f?10:12,u=f=0;break;case 2:for(;u<16;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(n.flags=f,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(C[0]=255&f,C[1]=f>>>8&255,n.check=ezlib.crc32(n.check,C,2,0)),u=f=0,n.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.head&&(n.head.time=f),512&n.flags&&(C[0]=255&f,C[1]=f>>>8&255,C[2]=f>>>16&255,C[3]=f>>>24&255,n.check=ezlib.crc32(n.check,C,4,0)),u=f=0,n.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(C[0]=255&f,C[1]=f>>>8&255,n.check=ezlib.crc32(n.check,C,2,0)),u=f=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(C[0]=255&f,C[1]=f>>>8&255,n.check=ezlib.crc32(n.check,C,2,0)),u=f=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(s<(d=n.length)&&(d=s),d&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),ezlib.utils.arraySet(n.head.extra,r,a,d,T)),512&n.flags&&(n.check=ezlib.crc32(n.check,r,d,a)),s-=d,a+=d,n.length-=d),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;for(d=0;T=r[a+d++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T)),T&&d<s;);if(512&n.flags&&(n.check=ezlib.crc32(n.check,r,d,a)),s-=d,a+=d,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;for(d=0;T=r[a+d++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T)),T&&d<s;);if(512&n.flags&&(n.check=ezlib.crc32(n.check,r,d,a)),s-=d,a+=d,T)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}u=f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;u<32;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}e.adler=n.check=D(f),u=f=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=f,n.bits=u,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){f>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}switch(n.last=1&f,--u,3&(f>>>=1)){case 0:n.mode=14;break;case 1:if(!function(e){if(B){var t;for(L=new Int32Array(512),M=new Int32Array(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ezlib.inflate_table(A,e.lens,0,288,L,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ezlib.inflate_table(U,e.lens,0,32,M,0,e.work,{bits:5}),B=!1}e.lencode=L,e.lenbits=9,e.distcode=M,e.distbits=5}(n),n.mode=20,6!==t)break;f>>>=2,u-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}f>>>=2,u-=2;break;case 14:for(f>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&f,u=f=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(d=n.length){if(s<d&&(d=s),l<d&&(d=l),0===d)break e;ezlib.utils.arraySet(i,r,a,d,o),s-=d,a+=d,l-=d,o+=d,n.length-=d;break}n.mode=12;break;case 17:for(;u<14;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(n.nlen=257+(31&f),f>>>=5,u-=5,n.ndist=1+(31&f),f>>>=5,u-=5,n.ncode=4+(15&f),f>>>=4,u-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.lens[z[n.have++]]=7&f,f>>>=3,u-=3}for(;n.have<19;)n.lens[z[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,P={bits:n.lenbits},_=ezlib.inflate_table(0,n.lens,0,19,n.lencode,0,n.work,P),n.lenbits=P.bits,_){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;w=(x=n.lencode[f&(1<<n.lenbits)-1])>>>16&255,p=65535&x,!((m=x>>>24)<=u);){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(p<16)f>>>=m,u-=m,n.lens[n.have++]=p;else{if(16===p){for(I=m+2;u<I;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(f>>>=m,u-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}T=n.lens[n.have-1],d=3+(3&f),f>>>=2,u-=2}else if(17===p){for(I=m+3;u<I;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}u-=m,T=0,d=3+(7&(f>>>=m)),f>>>=3,u-=3}else{for(I=m+7;u<I;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}u-=m,T=0,d=11+(127&(f>>>=m)),f>>>=7,u-=7}if(n.have+d>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;d--;)n.lens[n.have++]=T}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,P={bits:n.lenbits},_=ezlib.inflate_table(A,n.lens,0,n.nlen,n.lencode,0,n.work,P),n.lenbits=P.bits,_){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,P={bits:n.distbits},_=ezlib.inflate_table(U,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,P),n.distbits=P.bits,_){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=s&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=f,n.bits=u,ezlib.inflate_fast(e,c),o=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,f=n.hold,u=n.bits;break}for(;w=(x=n.lencode[f&(1<<n.lenbits)-1])>>>16&255,p=65535&x,!((m=x>>>24)<=u);){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(w&&0==(240&w)){for(k=m,v=w,y=p;w=(x=n.lencode[y+((f&(1<<k+v)-1)>>k)])>>>16&255,p=65535&x,!(k+(m=x>>>24)<=u);){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}f>>>=k,u-=k}if(f>>>=m,u-=m,n.length=p,0===w){n.mode=26;break}if(32&w){n.mode=12;break}if(64&w){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&w,n.mode=22;case 22:if(n.extra){for(I=n.extra;u<I;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,u-=n.extra}n.mode=23;case 23:for(;w=(x=n.distcode[f&(1<<n.distbits)-1])>>>16&255,p=65535&x,!((m=x>>>24)<=u);){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(0==(240&w)){for(k=m,v=w,y=p;w=(x=n.distcode[y+((f&(1<<k+v)-1)>>k)])>>>16&255,p=65535&x,!(k+(m=x>>>24)<=u);){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}f>>>=k,u-=k}if(f>>>=m,u-=m,64&w){e.msg="invalid distance code",n.mode=30;break}n.offset=p,n.extra=15&w,n.mode=24;case 24:if(n.extra){for(I=n.extra;u<I;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,u-=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(d=c-l,n.offset>d){if(d=n.offset-d,d>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}g=d>n.wnext?(d-=n.wnext,n.wsize-d):n.wnext-d,d>n.length&&(d=n.length),b=n.window}else b=i,g=o-n.offset,d=n.length;for(l<d&&(d=l),l-=d,n.length-=d;i[o++]=b[g++],--d;);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;i[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===s)break e;s--,f|=r[a++]<<u,u+=8}if(c-=l,e.total_out+=c,n.total+=c,c&&(e.adler=n.check=n.flags?ezlib.crc32(n.check,i,c,o-c):ezlib.adler32(n.check,i,c,o-c)),c=l,(n.flags?f:D(f))!==n.check){e.msg="incorrect data check",n.mode=30;break}u=f=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,f+=r[a++]<<u,u+=8}if(f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}u=f=0}n.mode=29;case 29:_=1;break e;case 30:_=-3;break e;case 31:return-4;case 32:default:return E}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=f,n.bits=u,(n.wsize||c!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&X(e,e.output,e.next_out,c-e.avail_out)?(n.mode=31,-4):(h-=e.avail_in,c-=e.avail_out,e.total_in+=h,e.total_out+=c,n.total+=c,n.wrap&&c&&(e.adler=n.check=n.flags?ezlib.crc32(n.check,i,c,e.next_out-c):ezlib.adler32(n.check,i,c,e.next_out-c)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==h&&0===c||4===t)&&_===R&&(_=-5),_)},inflateEnd:function(e){if(!e||!e.state)return E;var t=e.state;return t.window&&(t.window=null),e.state=null,R},inflateGetHeader:function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?E:((e.head=t).done=!1,R)},inflateSetDictionary:function(e,t){var n,r=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?E:11===n.mode&&ezlib.adler32(1,t,r,0)!==n.check?-3:X(e,t,r,r)?(n.mode=31,-4):(n.havedict=1,R)},inflateInfo:"ezlib"}}(),ezlib.inflate_table=ezlib.inflate_table||function(){var D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],B=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return function(e,t,n,r,i,a,o,s){for(var l,f,u,h,c,d,g,b,m,w,p,k,v,y,T,_,P,I,x=s.bits,C=null,z=0,A=new Uint16Array(16),U=new Uint16Array(16),R=null,E=0,S=0;S<=15;S++)A[S]=0;for(l=0;l<r;l++)A[t[n+l]]++;for(h=x,u=15;1<=u&&0===A[u];u--);if(u<h&&(h=u),0===u)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(f=1;f<u&&0===A[f];f++);for(h<f&&(h=f),S=g=1;S<=15;S++)if(g<<=1,(g-=A[S])<0)return-1;if(0<g&&(0===e||1!==u))return-1;for(U[1]=0,S=1;S<15;S++)U[S+1]=U[S]+A[S];for(l=0;l<r;l++)0!==t[n+l]&&(o[U[t[n+l]]++]=l);if(T=0===e?(C=R=o,19):1===e?(C=D,z-=257,R=L,E-=257,256):(C=M,R=B,-1),S=f,y=a,k=-1,v=(b=1<<(c=h))-1,1===e&&852<b||2===e&&592<b)return 1;for(d=l=m=0;;){for(_=S-d,I=o[l]<T?(P=0,o[l]):o[l]>T?(P=R[E+o[l]],C[z+o[l]]):(P=96,0),w=1<<S-d,p=1<<c,f=p;i[y+(m>>d)+(p-=w)]=_<<24|P<<16|I|0,0!==p;);for(w=1<<S-1;m&w;)w>>=1;if(0!==w?(m&=w-1,m+=w):m=0,l++,0==--A[S]){if(S===u)break;S=t[n+o[l]]}if(h<S&&(m&v)!==k){for(0===d&&(d=h),y+=f,g=1<<(c=S-d);c+d<u&&!((g-=A[c+d])<=0);)c++,g<<=1;if(b+=1<<c,1===e&&852<b||2===e&&592<b)return 1;i[k=m&v]=h<<24|c<<16|y-a|0}}return 0!==m&&(i[y+m]=S-d<<24|64<<16|0),s.bits=h,0}}(),ezlib.ZStream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},PngToy._bKGD=function(e){var t=e.view,n=e.chunks,r=PngToy._findChunk(n,"bKGD"),e=PngToy._IHDR(e);if(!r)return null;switch(e.type){case 0:case 4:return{background:[t.getUint16(r.offset)]};case 2:case 6:return{background:new Uint16Array(t.buffer,r.offset,6)};default:return{index:t.getUint8(r.offset)}}},PngToy._cHRM=function(e){var t=e.view,n=e.chunks,n=(e.allowInvalid,PngToy._findChunk(n,"cHRM"));return n?(n=n.offset,{whiteX:t.getUint32(n)/1e5,whiteY:t.getUint32(n+4)/1e5,redX:t.getUint32(n+8)/1e5,redY:t.getUint32(n+12)/1e5,greenX:t.getUint32(n+16)/1e5,greenY:t.getUint32(n+20)/1e5,blueX:t.getUint32(n+24)/1e5,blueY:t.getUint32(n+28)/1e5}):null},PngToy._oFFs=function(e){var t=e.view,n=e.chunks,r=e.allowInvalid,e=PngToy._findChunk(n,"oFFs"),n={};return e?(e=e.offset,n.x=t.getInt32(e),n.y=t.getInt32(e+4),n.unit=t.getUint8(e+8),n.desc=["Pixels","Micrometers"][n.unit]||"Invalid",!r&&(n.unit<0||1<n.unit)?{error:"Invalid unit for oFFs chunk."}:n):null},PngToy._pCAL=function(e){var t,n,r,i=e.view,a=e.chunks,o=e.allowInvalid,e=PngToy._findChunk(a,"pCAL"),s=!1,a={},l=[],f=0;if(!e.length)return null;for(t=e.offset,n=PngToy._getStr(i,t,80),a.calName=n.text,t=n.offset,n.warn&&(s=!0),a.x0=i.getInt32(t),a.x1=i.getInt32(t+4),a.eqType=i.getUint8(t+8),a.eqDesc=["Linear mapping","Base-e exponential mapping","Arbitrary-base exponential mapping","Hyperbolic mapping"][a.eqType]||null,a.paramCount=i.getUint8(t+9),t+=10,n=PngToy._getStr(i,t,1e4),a.unitName=n.text,t=n.offset,n.warn&&(s=!0),r=a.paramCount-1;f<r;f++)n=PngToy._getStr(i,t,1e4),l.push(n.text),t=n.offset,n.warn&&(s=!0);if(n=PngToy._getStr(i,t,e.length-(t-e.offset)),l.push(n.text),n.warn&&(s=!0),a.parameters=l,!o){if(a.x0===a.x1)return{error:"Invalid x0 or x1."};if(l.length!==a.paramCount)return{error:"Mismatching parameter count and number of parameters."};if(a.eqType<0||3<a.eqType)return{error:"Invalid equation type."};if(s)return{error:"One or more text field contains illegal chars."}}return a},PngToy._sCAL=function(e){var t=e.view,n=e.chunks,r=e.allowInvalid,i=PngToy._findChunk(n,"sCAL"),a={};return i.length?(e=i.offset,a.unit=t.getUint8(e++),a.desc=["meters","radians"][a.unit]||null,n=PngToy._getStr(t,e,1e5),a.unitsX=n.text,e=n.offset,n=PngToy._getStr(t,e,i.length-(e-i.offset)),a.unitsY=n.text,!r&&(a.unit<1||2<a.unit)?{error:"Invalid unit"}:a):null},PngToy._sTER=function(e){var t=e.view,n=e.chunks,r=e.allowInvalid,e=PngToy._findChunk(n,"sTER"),n={};return e?(e=e.offset,n.mode=t.getUint8(e),n.desc=["Cross-fuse layout","Diverging-fuse layout"][n.mode],!r&&(n.mode<0||1<n.mode)?{error:"Invalid mode for sTER chunk."}:n):null},PngToy._gAMA=function(e){var t=e.view,n=e.chunks,n=(e.allowInvalid,PngToy._findChunk(n,"gAMA"));return n?{gamma:t.getUint32(n.offset)/1e5}:null},PngToy._hIST=function(e){var t,n,r=e.view,i=e.chunks,a=e.allowInvalid,i=PngToy._findChunk(i,"hIST"),e=PngToy._PLTE(e),o=[];if(!i)return null;if(!a&&i.length%2)return{error:"Invalid length of hIST chunk."};for(n=(t=i.offset)+i.length;t<n;t+=2)o.push(r.getUint16(t));return a||o.length===e.length?{histogram:o}:{error:"hIST chunk must have same number of entries as PLTE chunk."}},PngToy._iCCP=function(){var e,t,n,r,i=host.view,a=host.chunks,o=host.allowInvalid,s=PngToy._findChunk(a,"iCCP"),l={name:null,icc:null};if(!s)return null;if(e=s.offset,t=(a=PngToy._getStr(i,e,80)).text,e=a.offset,!o)for(n=0;n<t.length;n++)if(!(31<(r=t.charCodeAt(n))&&r<127||160<r&&r<256))return{error:"ICC profile contains illegal chars in name."};if(l.name=t,i.getUint8(e++)&&!o)return{error:"Invalid compression type."};try{l.icc=ezlib.inflate(new Uint8Array(i.buffer,e,s.length-(e-s.offset)))}catch(e){if(!o)return{error:e}}return l},PngToy._IDAT=function(e){for(var t,n=e.buffer,r=e.chunks,e=e.allowInvalid,i=0,a=!1,o=new ezlib.Inflate,s=!1;t=r[i++];)if("IDAT"===t.name){s=!0;break}for(;t;)a="IEND"===t.name,"IDAT"===t.name&&o.push(new Uint8Array(n,t.offset,t.length),a),t=r[i++];return a||e?s?o.err?{error:o.msg}:{buffer:o.result}:e?{buffer:null}:{error:"Critical - no IDAT chunk(s)."}:{error:"Critical - missing IEND chunk."}},PngToy._IHDR=function(e){var t,n=e.view,r=e.chunks,e=e.allowInvalid,r=PngToy._findChunk(r,"IHDR");if(!r)return{error:"Critical - IHDR chunk is missing."};if(r=r.offset,t={width:n.getUint32(r),height:n.getUint32(r+4),depth:n.getUint8(r+8),type:n.getUint8(r+9),compression:n.getUint8(r+10),filter:n.getUint8(r+11),interlaced:n.getUint8(r+12)},!e){if([0,2,3,4,6].indexOf(t.type)<0)return{error:"Invalid color type."};switch(t.type){case 0:if([1,2,4,8,16].indexOf(t.depth)<0)return{error:"Invalid color depth."};break;case 3:if([1,2,4,8].indexOf(t.depth)<0)return{error:"Invalid color depth."};break;default:if([8,16].indexOf(t.depth)<0)return{error:"Invalid color depth."}}if(!t.width||!t.height)return{error:"Invalid dimension."};if(t.compression)return{error:"Invalid compression type."};if(t.filter)return{error:"Invalid filter type."};if(t.interlaced<0||1<t.interlaced)return{error:"Invalid interlace mode "+t.interlaced}}return t},PngToy._iTXt=function(e){var n,r,i,a=e.view,t=e.chunks,o=e.allowInvalid,t=PngToy._findChunks(t,"iTXt"),s=!1,l=!1,f=[];return t.length?(t.forEach(function(e){if(!l){var t={};if(n=e.offset,i=PngToy._getStr(a,n,80),t.keyword=i.text,n=i.offset,i.warn&&(s=!0),t.hasCompression=a.getUint8(n),t.compression=a.getUint8(n+1),n+=2,i=PngToy._getStr(a,n,20),t.language=i.text.toLowerCase(),n=i.offset,i.warn&&(s=!0),i=PngToy._getStr(a,n,80),t.keywordLang=i.text,n=i.offset,i.warn&&(s=!0),r=new Uint8Array(a.buffer,n,e.length-(n-e.offset)),1===t.hasCompression)if(o||t.compression)try{t.text=ezlib.inflate(r,{to:"string"})}catch(e){o?t.text="":t={error:e}}else t={error:"Invalid compression type for iTXt."};else t.hasCompression?o?t.text="":t={error:"Invalid compression flag."}:t.text=(new TextDecoder).decode(r);if(!o&&s)return l=!0,{error:"One or more field contains illegal chars."};f.push(t)}}),f):null},PngToy._pHYs=function(e){var t=e.view,n=e.chunks,r=e.allowInvalid,e=PngToy._findChunk(n,"pHYs"),n={};if(!e)return null;if(e=e.offset,n.ppuX=t.getUint32(e),n.ppuY=t.getUint32(e+4),n.unit=t.getUint8(e+8),1===n.unit?n.desc="Meters":n.desc="ratio",r)n.ppuX&=2147483647,n.ppuY&=2147483647,n.unit&=1;else{if(2147483647<n.ppuX||2147483647<n.ppuY)return{error:"Invalid unit lengths."};if(n.unit<0||1<n.unit)return{error:"Invalid unit for pHYs chunk."}}return n},PngToy._PLTE=function(e){var t=e.buffer,n=e.chunks,e=e.allowInvalid,n=PngToy._findChunk(n,"PLTE");if(!n)return null;if(n=new Uint8Array(t,n.offset,n.length),!e){if(n.length%3)return{error:"Invalid palette size."};if(n.length<3||768<n.length)return{error:"Invalid number of palette entries."}}return{palette:n,length:n.length/3}},PngToy._sBIT=function(e){var t,n=e.view,r=e.chunks,i=e.allowInvalid,a=PngToy._findChunk(r,"sBIT"),r=PngToy._IHDR(e),e=!1,o={grey:null,alpha:null,red:null,green:null,blue:null};if(!a)return null;switch(t=a.offset,a=3===r.type?8:r.depth,r.type){case 0:o.grey=n.getUint8(t);break;case 2:case 3:o.red=n.getUint8(t++),o.green=n.getUint8(t++),o.blue=n.getUint8(t);break;case 4:o.grey=n.getUint8(t++),o.alpha=n.getUint8(t);break;case 6:o.red=n.getUint8(t++),o.green=n.getUint8(t++),o.blue=n.getUint8(t++),o.alpha=n.getUint8(t)}return!i&&(null!==o.red&&(o.red>a||0===o.red)&&(e=!0),null!==o.green&&(o.green>a||0===o.green)&&(e=!0),null!==o.blue&&(o.blue>a||0===o.blue)&&(e=!0),null!==o.grey&&(o.grey>a||0===o.grey)&&(e=!0),null!==o.alpha&&(o.alpha>a||0===o.alpha)&&(e=!0),e)?{error:"Invalid sBIT chunk."}:o},PngToy._sPLT=function(e){var u=e.view,t=e.chunks,h=e.allowInvalid,t=PngToy._findChunks(t,"sPLT"),c=[];return t.length?(t.forEach(function(e){var t,n,r,i,a,o={depth:null,name:null,palette:[],entries:0},s=[],l=e.offset,f=PngToy._getStr(u,l,80);for(o.name=f.text,l=f.offset,o.depth=u.getUint8(l++),n=8===o.depth?6:10,r=8===o.depth?1:2,t=e.length-(l-e.offset),a=(6==n?u.getUint8:u.getUint16).bind(u),i=0;i<t;i+=n)s.push(a(l+i),a(l+i+r),a(l+i+2*r),a(l+i+3*r),u.getUint16(l+i+4*r));if(o.palette=s,o.entries=s.length/n,!h&&(8===o.depth&&t%6||16===o.depth&&t%10))return{error:"Invalid sPLT chunk."};c.push(o)}),c):null},PngToy._sRGB=function(e){var t=e.view,n=e.chunks,e=e.allowInvalid,n=PngToy._findChunk(n,"sRGB");return n?(n=t.getUint8(n.offset),!e&&(n<0||3<n)?{error:"Invalid range for sRGB render intent."}:{intent:n,desc:["Perceptual","Relative colorimetric","Saturation","Absolute colorimetric"][n]||null}):null},PngToy._tEXt=function(e){var n,r,i=e.view,t=e.chunks,a=e.allowInvalid,t=PngToy._findChunks(t,"tEXt"),o=!1,s=!1,l=[];return t.length?(t.forEach(function(e){if(!s){var t={};return n=e.offset,r=PngToy._getStr(i,n,80),t.keyword=r.text,n=r.offset,r.warn&&(o=!0),n=new Uint8Array(i.buffer,n,e.length-(n-e.offset)),t.text=(new TextDecoder).decode(n),l.push(t),!a&&o?(s=!0,{error:"One or more field contains illegal chars."}):void 0}}),l):null},PngToy._tIME=function(t){var e,n=t.view,r=t.chunks,t=t.allowInvalid,r=PngToy._findChunk(r,"tIME");if(!r)return null;if(r=r.offset,e={year:n.getUint16(r),month:n.getUint8(r+2),day:n.getUint8(r+3),hour:n.getUint8(r+4),minute:n.getUint8(r+5),second:n.getUint8(r+6),date:null},!t&&(e.year<0||65535<e.year||e.month<1||12<e.month||e.day<1||31<e.day||e.hour<0||23<e.hour||e.minute<0||59<e.minute||e.second<0||60<e.second))return{error:"Invalid timestamp."};try{e.date=new Date(e.year,e.month-1,e.day,e.hour,e.minute,Math.min(59,e.second))}catch(e){if(!t)return{error:e}}return e},PngToy._tRNS=function(e){var t,n=e.buffer,r=e.chunks,i=e.allowInvalid,a=PngToy._findChunk(r,"tRNS"),r=PngToy._PLTE(e),e=PngToy._IHDR(e);if(!a)return null;if(!i&&2===e.type&&a.length%6)return{error:"Invalid tRNS length."};switch(e.type){case 0:t={alphas:new Uint16Array(n.slice(a.offset,a.offset+a.length)),length:a.length>>1};break;case 2:t={alphas:new Uint16Array(n.slice(a.offset,a.offset+a.length)),length:a.length/6};break;case 3:t={alphas:new Uint8Array(n,a.offset,a.length),length:a.length};break;default:return i?{alphas:null,length:0}:{error:"tRNS chunk is not valid for this color type."}}return!i&&r&&t.length>r.length?{error:"tRNS chunk contains more entries than palette entries."}:t},PngToy._zTXt=function(e){var n,r,i=e.view,t=e.chunks,a=e.allowInvalid,t=PngToy._findChunks(t,"zTXt"),o=!1,s=!1,l=[];return t.length?(t.forEach(function(e){if(!s){var t={};if(n=e.offset,r=PngToy._getStr(i,n,80),t.keyword=r.text,n=r.offset,r.warn&&(o=!0),i.getUint8(n++)&&!a)t={error:"Invalid compression type."};else try{t.text=ezlib.inflate(new Uint8Array(i.buffer,n,e.length-(n-e.offset)),{to:"string"})}catch(e){a?t.text="":t={error:e}}if(!a&&o)return s=!0,{error:"One or more field contains illegal chars."};l.push(t)}}),l):null},PngToy._getChunks=function(e,t,n,r){var i,a,o,s,l,f,u,h,c,d,g,b,m,w=this,p=8,k=e.byteLength,v=[],y=!0,T=["iTXT","tIME","tEXt","zTXt"],_=PngToy._findChunk,P="Invalid number of ",I="Invalid chunk order for ";if(n&&!this.table){this.table=new Uint32Array(256);for(var x,C=0;C<256;C++){for(s=C>>>0,x=0;x<8;x++)s=1&s?3988292384^s>>>1:s>>>1;this.table[C]=s}}for(;p<k;){if(i=R(),m=b=void 0,b=R(),a=(m=String.fromCharCode)(b>>>24)+m(b>>16&255)+m(b>>8&255)+m(255&b),2147483647<i&&!r)return{error:"Invalid chunk size."};if(o=p,p=o+i,s=R(),i=new PngToy.Chunk(a,o,i,s,e),n&&(d=i,g=void 0,g=new Uint8Array(e,d.offset-4,d.length+4),d.crcOk=d.crc===function(e){for(var t=-1>>>0,n=e.length,r=0;r<n;r++)t=t>>>8^w.table[255&(t^e[r])];return(-1^t)>>>0}(g),!i.crcOk&&!r))return{error:"Invalid CRC in chunk "+a};if(i.isReserved&&!r)return{error:"Invalid chunk name: "+a};v.push(i)}if(!r){if(!z("IHDR",1,1))return{error:P+"IHDR chunks."};if(!z("tIME",0,1))return{error:P+"tIME chunks."};if(!z("zTXt",0,-1))return{error:P+"zTXt chunks."};if(!z("tEXt",0,-1))return{error:P+"tEXt chunks."};if(!z("iTXt",0,-1))return{error:P+"iTXt chunks."};if(!z("pHYs",0,1))return{error:P+"pHYs chunks."};if(!z("sPLT",0,-1))return{error:P+"sPLT chunks."};if(!z("iCCP",0,1))return{error:P+"iCCP chunks."};if(!z("sRGB",0,1))return{error:P+"sRGB chunks."};if(!z("sBIT",0,1))return{error:P+"sBIT chunks."};if(!z("gAMA",0,1))return{error:P+"gAMA chunks."};if(!z("cHRM",0,1))return{error:P+"cHRM chunks."};if(!z("PLTE",0,1))return{error:P+"PLTE chunks."};if(!z("tRNS",0,1))return{error:P+"tRNS chunks."};if(!z("hIST",0,1))return{error:P+"hIST chunks."};if(!z("bKGD",0,1))return{error:P+"bKGD chunks."};if(!z("IDAT",1,-1))return{error:P+"IDAT chunks."};if(!z("IEND",1,1))return{error:P+"IEND chunks."};if("IHDR"!==v[0].name||"IEND"!==v[v.length-1].name)return{error:"Invalid PNG chunk order."};if(l=t.getUint8(_(v,"IHDR").offset+9),f=_(v,"PLTE"),h=_(v,"hIST"),u=_(v,"tRNS"),c=_(v,"oFFs"),P=_(v,"sTER"),_(v,"iCCP")&&_(v,"sRGB"))return{error:"Both iCCP and sRGB cannot be present."};if(3===l&&!f)return{error:"Missing PLTE chunk."};if((0===l||4===l)&&f)return{error:"PLTE chunk should not appear with this color type."};if((4===l||6===l)&&u)return{error:"tRNS chunk should not appear with this color type."};if(h&&!f)return{error:"hIST chunk can only appear if a PLTE chunk is present."};if(f){if(!U("PLTE","IDAT"))return{error:I+"PLTE."};if(h&&!A("PLTE","hIST","IDAT"))return{error:I+"hIST."};if(u&&!A("PLTE","tRNS","IDAT"))return{error:I+"tRNS."};if(_(v,"bKGD")&&!A("PLTE","bKGD","IDAT"))return{error:I+"bKGD."};if(!U("cHRM","PLTE"))return{error:I+"cHRM."};if(!U("gAMA","PLTE"))return{error:I+"gAMA."};if(!U("iCCP","PLTE"))return{error:I+"iCCP."};if(!U("sRGB","PLTE"))return{error:I+"sRGB."}}if(c&&!U("oFFs","IDAT"))return{error:I+"oFFs."};if(P&&!U("sTER","IDAT"))return{error:I+"sTER."};for(C=v.length-2;0<C;C--)if(y&&"IDAT"!==v[C].name&&T.indexOf(v[C].name)<0)y=!1;else if(!y&&"IDAT"===v[C].name)return{error:"Invalid chunk inside IDAT chunk sequence."}}return{chunks:v};function z(e,t,n){e=PngToy._findChunks(v,e);return n<0?e.length>=t:e.length>=t&&e.length<=n}function A(e,t,n){return U(e,t)&&U(t,n)}function U(e,t){for(var n=-1,r=-1,i=v.length,a=0;a<i;a++)v[a].name===e&&(n=a),v[a].name===t&&(r=a);return n<r}function R(){var e=t.getUint32(p);return p+=4,e>>>0}},PngToy._getChunks.table=null,PngToy._findChunk=function(e,t){for(var n,r=0;n=e[r++];)if(n.name===t)return n;return null},PngToy._findChunks=function(e,t){var n=[];return e.forEach(function(e){e.name===t&&n.push(e)}),n},PngToy._getStr=function(e,t,n){var r,i="",a=t,o=-1,s=!1,l=String.fromCharCode;for(n+=a;a<n&&o&&(o=e.getUint8(a++));)r=l(o),-1<" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"%&'()*+,-./:;<=>?_".indexOf(r)?i+=r:s=!0;return{offset:a,text:i,warning:s}},PngToy.Chunk=function(e,t,n,r,i){this.name=e,this.offset=t,this.length=n,this.crc=r,this.crcOk=!0,this.isCritical=!(32&e.charCodeAt(0)),this.isPrivate=!!(32&e.charCodeAt(1)),this.isReserved=!!(32&e.charCodeAt(2)),this.isCopySafe=!!(32&e.charCodeAt(3)),this.buffer=i},PngToy.Chunk.prototype={getRaw:function(e){return e?new Uint8Array(this.buffer,this.offset-8,this.length+12):new Uint8Array(this.buffer,this.offset,this.length)}},PngToy.prototype.convertToCanvas=function(e,l){var t=this;return l=l||{},new Promise(function(o,s){t.convertToRGBA(e,l).then(function(e){try{var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height;var r,i,a=n.createImageData(e.width,e.height);a.data.set(e.bitmap),n.putImageData(a,0,0),1===e.ratioY&&1===e.ratioX||l.ignoreAspectRatio||(a=(n=document.createElement("canvas")).getContext("2d"),1<=e.ratioY?(r=t.width,i=t.height*e.ratioY|0):e.ratioY<1&&(r=t.width*e.ratioX|0,i=t.height),n.width=r,n.height=i,a.drawImage(t,0,0,r,i),t=n),o(t)}catch(e){s(e)}},s)})},PngToy.prototype.convertToRGBA=function(L,M){var B=this;return M=M||{},new Promise(function(i){var a,o,n,s,l,f,e,u,h,c,d,g,b,m,w,p,k,t,r;function v(){var e=d[0|b],t=(b-(0|b))/u,e=e&128>>t?255:0,t=s.length&&s[0]>>>8&128>>t==e?0:255;return b+=u,[e,e,e,t]}function y(){var e=85*(d[0|b]>>>((b-(0|b))/u<<1)&3)&255,t=s.length&&85*(s[0]>>>8&3)&255==e?0:255;return b+=u,[e,e,e,t]}function T(){var e=d[0|b],t=(b-(0|b))/u?(15&e)<<4:240&e,e=s.length&&(3840&s[0])>>>4==t?0:255;return b+=u,[t,t,t,e]}function _(){var e=3*(d[0|b]&128>>>(b-(0|b))/u?1:0);return b+=u,[n[e],n[1+e],n[2+e],255]}function P(){var e=(d[0|b]<<((b-(0|b))/u<<1)&192)>>>6,t=3*e,e=e<s.length?s[e]:255;return b+=u,[n[t],n[1+t],n[2+t],e]}function I(){var e=d[0|b],t=(b-(0|b))/u?15&e:(240&e)>>>4,e=3*t,t=t<s.length?s[t]:255;return b+=u,[n[e],n[1+e],n[2+e],t]}function x(){var e=d[b++],t=s.length&&e===s[0]>>>8?0:255;return[e&=255,e,e,t]}function C(){var e=d[b++],t=s.length&&s[0]===e?0:255;return[e&=255,e,e,t]}function z(){var e,t,n,r=d[b++],i=d[b++],a=d[b++],o=255;return s.length&&(e=s[0]>>>8,t=s[1]>>>8,n=s[2]>>>8,e===r&&t===i&&n===a&&(o=0)),[255&r,255&i,255&a,o]}function A(){return[d[b++],d[b++],d[b++],d[b++]]}function U(){var e=d[b++],t=d[b++],n=d[b++];return[255&e,255&t,255&n,s.length&&s[0]===e&&s[1]===t&&s[2]===n?0:255]}function R(){var e=d[b++];return[e,e,e,d[b++]]}function E(){var e=255&d[b++];return[e,e,e,255&d[b++]]}function S(){var e=d[b++],t=3*e;return[n[t],n[1+t],n[2+t],e<s.length?s[e]:255]}function D(){return[255&d[b++],255&d[b++],255&d[b++],255&d[b++]]}6!==L.type||8!==L.depth||M.useGamma?(l=L.width,f=L.height,e=L.type,t=L.depth,u=t/8,h=[1,0,3,1,2,0,4][e],c=function(e,t){{if(16===t)return[C,0,U,S,E,0,D][e];if(!(t<8))return[x,0,z,S,R,0,A][e];switch(t){case 1:return e?_:v;case 2:return e?P:y;case 4:return e?I:T}}}(e,t),d=L.bitmap,g=new Uint8Array(l*f*4),m=b=0,w=d.byteLength,3===L.type&&(r=B.getChunk("PLTE"),n=r?r.palette:[]),t=B.getChunk("tRNS"),s=t&&t.alphas?t.alphas:[],a=B.getChunk("pHYs"),o=(o=B.getChunk("gAMA"))?o.gamma:1,function e(){var t=PngToy._blockSize,n=l*u*h,r=b+n;if(M.useGamma)for(k=k||B.getGammaLUT(o,M.gamma||1);b<w&&0<t;)r<=b&&(r=(b=Math.ceil(b))+n),p=c(),g[m++]=k[p[0]],g[m++]=k[p[1]],g[m++]=k[p[2]],g[m++]=p[3],t--;else for(;b<w&&0<t;)r<=b&&(r=(b=Math.ceil(b))+n),p=c(),g[m++]=p[0],g[m++]=p[1],g[m++]=p[2],g[m++]=p[3],t--;b<w?setTimeout(e,PngToy._delay):i({bitmap:g,width:l,height:f,ratioX:a?a.ppuY/(a.ppuX||1):1,ratioY:a?a.ppuX/(a.ppuY||1):1})}()):(t=(r=M.ignoreAspectRatio?null:B.getChunk("pHYs"))?r.ppuY/(r.ppuX||1):1,r=r?r.ppuX/(r.ppuY||1):1,(M.ignoreAspectRatio||!M.ignoreAspectRatio&&1==t&&1==r)&&i({bitmap:L.bitmap,width:L.width,height:L.height,ratioX:t,ratioY:r}))})},PngToy.prototype.decode=function(){var B=this;return new Promise(function(s,l){var f,u,h,c,d,e=B.getChunk("IHDR"),g=e.width,b=e.height,t=e.type,n=e.depth/8,r=2===n,m=[1,0,3,1,2,0,4][t],o=r?65535:255,w=m*n,p=g*w,k=p+Math.ceil(w),v=B.getChunk("IDAT").buffer,y=new Uint8Array(Math.max(1,Math.ceil(g*w)*b)),T=[function(e){return e},function(e,t){return e+i(t)},function(e,t,n){return e+a(n)},function(e,t,n){return e+(i(t)+a(n)>>>1)},function(e,t,n,r){return e+function(e,t,n){var r=e+t-n,i=Math.abs(r-e),a=Math.abs(r-t),r=Math.abs(r-n);return i<=a&&i<=r?e:a<=r?t:n}(i(t),a(n),a(r))}],_=0,P=0,I=0,x=0,C=0,z=v.byteLength,A=v.length,U=[0,4,0,2,0,1,0],R=[0,0,4,0,2,0,1],E=[8,8,4,4,2,2,1],S=[8,8,8,4,4,2,2],D=[8,4,4,2,2,1,1],L=[8,8,4,4,2,2,1];function M(){return{bitmap:new(r?Uint16Array:Uint8Array)(y.buffer),width:g,height:b,byteWidth:n,pixelWidth:m,depth:e.depth,type:e.type}}function i(e){return e<I?0:y[e]>>>0}function a(e){return e<x?0:y[e]>>>0}B.debug={pixelWidth:m,byteWidth:n,delta:w,lineLen:p,lineDlt:k,filters:[],preFilt:-1,postFilt:-1,srcPos:-1,srcLen:v.length,pass:0,x:-1,stepX:0,stepY:0,stepsX:0,stepsY:0},e.interlaced?("undefined"!=typeof console&&console.log("WARN: In current alpha interlaced PNGs will not decode properly unless all line-filters are filter 0."),f=C=c=0,u=h=8,setTimeout(function e(){try{PngToy._blockSize;var t,n,r,i=B.debug.filters,a=g/u|0,o=b/h|0,o=a*o;for(new Uint8Array(o);C<b;)if(A<=_)C=b;else{for(n=v[_++],i.indexOf(n)<0&&i.push(n),(n<0||4<n)&&(B.debug.preFilt=v[_-2],B.debug.postFilt=v[_],B.debug.srcPos=_,B.debug.pass=f,B.debug.x=d,B.debug.stepX=u,B.debug.stepY=h,B.debug.stepsX=g/u,B.debug.stepsY=b/h),t=T[n],lineEnd=Math.min(z,Math.ceil(_+p)),I=C*p,x=Math.max(0,I-p),d=c;d<p;){for(P=I+d*w|0,r=0;r<m;)t(v[_++],P-Math.ceil(w),P-p,P-Math.ceil(k)),P++,r++;d+=u*w}C+=h}C<b?setTimeout(e,PngToy._delay):++f<7?(C=R[f],c=U[f],u=E[f],h=S[f],D[f],L[f],setTimeout(e,PngToy._delay)):s(M())}catch(e){l(e)}},PngToy._delay)):setTimeout(function e(){try{var t,n,r,i=B.debug.filters,a=PngToy._blockSize;for(w=Math.ceil(w);C<b&&0<a;){for(r=v[_++],t=T[r],i.indexOf(r)<0&&i.push(r),n=Math.min(z,_+p),I=P;_<n;)y[P]=t(v[_++],P-w,P-p,P-k)&o,P++;x=I,a-=p,C++}C<b?setTimeout(e,PngToy._delay):s(M())}catch(e){l(e)}},PngToy._delay)})};